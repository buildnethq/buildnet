syntax = "proto3";

package buildnet.v5;

option go_package = "github.com/buildnethq/buildnet/hub/gen/buildnet/v5;buildnetv5";

// FleetService is the minimal "network exists" wedge: workers can join, heartbeat, and be listed.
service FleetService {
  rpc Join(JoinRequest) returns (JoinResponse);
  rpc Heartbeat(HeartbeatRequest) returns (HeartbeatResponse);
  rpc ListWorkers(ListWorkersRequest) returns (ListWorkersResponse);
}

message ResourceCaps {
  uint32 cpu_cores = 1;   // normalized logical cores
  uint64 mem_bytes = 2;   // total memory available for actions
  uint64 disk_bytes = 3;  // optional: available disk for workspace/cache
}

enum WorkerClass {
  WORKER_CLASS_UNSPECIFIED = 0;
  WORKER_CLASS_FULL = 1;    // server/workstation/laptop
  WORKER_CLASS_EDGE = 2;    // small edge devices
  WORKER_CLASS_MOBILE = 3;  // phones/tablets (constrained, opportunistic)
  WORKER_CLASS_AI = 4;      // "cognitive" endpoints (future)
}

message WorkerInfo {
  string worker_id = 1;           // stable identity (client-chosen for now)
  WorkerClass worker_class = 2;   // coarse class
  string os = 3;                  // "darwin", "linux", "windows"
  string arch = 4;                // "amd64", "arm64"
  ResourceCaps caps = 5;
  map<string,string> labels = 6;  // freeform
}

message JoinRequest {
  string join_token = 1;  // simple alpha token gate (replace later with stronger enrollment)
  WorkerInfo info = 2;
}

message JoinResponse {
  string worker_api_key = 1; // hub-minted secret; used for heartbeats
  uint64 lease_ttl_ms = 2;   // suggested heartbeat lease interval
  uint64 server_epoch = 3;   // monotonic-ish value for audit ordering (alpha: unix ms)
}

message HeartbeatRequest {
  string worker_id = 1;
  string worker_api_key = 2;
  uint64 now_ms = 3;
}

message HeartbeatResponse {
  bool ok = 1;
  uint64 server_epoch = 2;
}

message ListWorkersRequest {}

message WorkerRecord {
  WorkerInfo info = 1;
  uint64 last_seen_ms = 2;
}

message ListWorkersResponse {
  repeated WorkerRecord workers = 1;
  uint64 server_epoch = 2;
}
